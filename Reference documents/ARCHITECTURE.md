# ğŸ—ï¸ ç³»çµ±æ¶æ§‹æ–‡ä»¶

> æœ€å¾Œæ›´æ–°ï¼š2026-01-29  
> ç‰ˆæœ¬ï¼šv1.2.2

## ğŸ“‹ ç›®éŒ„

1. [ç³»çµ±æ¦‚è¦½](#ç³»çµ±æ¦‚è¦½)
2. [æŠ€è¡“æ£§](#æŠ€è¡“æ£§)
3. [ç³»çµ±æ¶æ§‹](#ç³»çµ±æ¶æ§‹)
4. [è³‡æ–™æµ](#è³‡æ–™æµ)
5. [æ ¸å¿ƒæ¨¡çµ„](#æ ¸å¿ƒæ¨¡çµ„)
6. [è³‡æ–™åº«è¨­è¨ˆ](#è³‡æ–™åº«è¨­è¨ˆ)
7. [API æ¶æ§‹](#api-æ¶æ§‹)
8. [å®‰å…¨æ€§æ¶æ§‹](#å®‰å…¨æ€§æ¶æ§‹)
9. [éƒ¨ç½²æ¶æ§‹](#éƒ¨ç½²æ¶æ§‹)
10. [Credits ç³»çµ±èˆ‡æ¨¡å‹ç®¡ç†](#credits-ç³»çµ±èˆ‡æ¨¡å‹ç®¡ç†)

---

## ç³»çµ±æ¦‚è¦½

**Health Care Assistant** æ˜¯ä¸€å€‹åŸºæ–¼ Next.js çš„æ™ºèƒ½è‡¨åºŠåˆ†æåŠ©æ‰‹ï¼Œæä¾›æª¢é©—å ±å‘Šã€æ”¾å°„å½±åƒã€ç—…æ­·è³‡æ–™å’Œè—¥ç‰©ç›¸é—œçš„ AI åˆ†æåŠŸèƒ½ã€‚

### æ ¸å¿ƒåŠŸèƒ½

- âœ… **å¤šç¨®èªè­‰æ–¹å¼**ï¼šå¯†ç¢¼ã€OTPã€Google OAuth
- âœ… **æ™ºèƒ½å°è©±ç³»çµ±**ï¼šæ”¯æ´æ–‡å­—ã€åœ–ç‰‡ã€æª”æ¡ˆä¸Šå‚³
- âœ… **AI æ•´åˆ**ï¼šç›´æ¥ä½¿ç”¨ Anthropic Claude API
- âœ… **å·¥ä½œé‡ç´šåˆ¥æ§åˆ¶**ï¼šå³æ™‚/åˆç´š/æ¨™æº–/å°ˆæ¥­
- âœ… **åŠŸèƒ½é¸æ“‡**ï¼šæª¢é©—/æ”¾å°„/ç—…æ­·/è—¥ç‰©
- âœ… **å°è©±æ­·å²ç®¡ç†**ï¼šå®Œæ•´çš„å°è©±è¨˜éŒ„èˆ‡æŸ¥è©¢
- âœ… **ç®¡ç†å“¡ç³»çµ±**ï¼šå¸³è™Ÿå¯©æ ¸èˆ‡ç®¡ç†åŠŸèƒ½
- âœ… **Credits ç³»çµ±**ï¼šé»æ•¸ç®¡ç†ã€æ¶ˆè²»è¨˜éŒ„ã€é¤˜é¡æŸ¥è©¢
- âœ… **å¤šæ¨¡å‹æ”¯æ´**ï¼šæ”¯æ´å¤šç¨® AI æ¨¡å‹é¸æ“‡èˆ‡å®šåƒ¹ç®¡ç†

---

## æŠ€è¡“æ£§

### å‰ç«¯æŠ€è¡“

| æŠ€è¡“ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| **Next.js** | 14+ | React æ¡†æ¶ï¼ŒApp Router |
| **TypeScript** | 5+ | é¡å‹å®‰å…¨ |
| **Tailwind CSS** | 3.4+ | æ¨£å¼æ¡†æ¶ |
| **React** | 18+ | UI æ¡†æ¶ |

### å¾Œç«¯æŠ€è¡“

| æŠ€è¡“ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| **Next.js API Routes** | 14+ | å¾Œç«¯ API |
| **Supabase** | 2.90+ | PostgreSQL è³‡æ–™åº« |
| **JWT (jose)** | 6.1+ | Session ç®¡ç† |
| **bcryptjs** | 3.0+ | å¯†ç¢¼åŠ å¯† |

### ç¬¬ä¸‰æ–¹æœå‹™

| æœå‹™ | ç”¨é€” |
|------|------|
| **Anthropic Claude API** | AI å°è©±å¼•æ“ |
| **Google OAuth 2.0** | ç¬¬ä¸‰æ–¹ç™»å…¥ |
| **Resend** | Email æœå‹™ï¼ˆOTP ç™¼é€ï¼‰ |
| **Cloudflare R2** | ç‰©ä»¶å„²å­˜ï¼ˆæª”æ¡ˆä¸Šå‚³ï¼‰ |

### é–‹ç™¼å·¥å…·

| å·¥å…· | ç”¨é€” |
|------|------|
| **Zod** | è³‡æ–™é©—è­‰ |
| **ESLint** | ç¨‹å¼ç¢¼æª¢æŸ¥ |
| **TypeScript** | é¡å‹æª¢æŸ¥ |
| **Vitest** | å–®å…ƒæ¸¬è©¦èˆ‡æ•´åˆæ¸¬è©¦ |
| **@testing-library/react** | React å…ƒä»¶æ¸¬è©¦ |

---

## ç³»çµ±æ¶æ§‹

### é«˜å±¤æ¶æ§‹åœ–

```mermaid
flowchart TB
    subgraph "Client Layer"
        Browser[ç€è¦½å™¨]
    end
    
    subgraph "Next.js Application"
        subgraph "Frontend"
            AuthPages[èªè­‰é é¢<br/>Login/Register]
            ChatPages[å°è©±é é¢<br/>Chat/Conversations]
            AdminPages[ç®¡ç†é é¢<br/>Admin]
            Components[React å…ƒä»¶]
        end
        
        subgraph "API Layer"
            AuthAPI[èªè­‰ API<br/>/api/auth/*]
            ChatAPI[å°è©± API<br/>/api/chat]
            AdminAPI[ç®¡ç† API<br/>/api/admin/*]
        end
        
        subgraph "Business Logic"
            AuthLib[èªè­‰æ¨¡çµ„<br/>lib/auth]
            MCPLib[MCP æ•´åˆ<br/>lib/mcp]
            StorageLib[å„²å­˜æ¨¡çµ„<br/>lib/storage]
            ValidationLib[é©—è­‰æ¨¡çµ„<br/>lib/validation]
            CreditsLib[Credits æ¨¡çµ„<br/>lib/supabase/credits]
            ModelPricingLib[æ¨¡å‹å®šåƒ¹æ¨¡çµ„<br/>lib/supabase/model-pricing]
        end
    end
    
    subgraph "External Services"
        Supabase[(Supabase<br/>PostgreSQL)]
        Anthropic[Anthropic API<br/>Claude AI]
        Google[Google OAuth]
        Resend[Resend<br/>Email]
        R2[Cloudflare R2<br/>ç‰©ä»¶å„²å­˜]
    end
    
    Browser --> AuthPages
    Browser --> ChatPages
    Browser --> AdminPages
    
    AuthPages --> AuthAPI
    ChatPages --> ChatAPI
    AdminPages --> AdminAPI
    
    AuthAPI --> AuthLib
    ChatAPI --> MCPLib
    ChatAPI --> StorageLib
    ChatAPI --> CreditsLib
    ChatAPI --> ModelPricingLib
    
    AuthLib --> Supabase
    CreditsLib --> Supabase
    ModelPricingLib --> Supabase
    AuthLib --> Google
    AuthLib --> Resend
    
    MCPLib --> Anthropic
    StorageLib --> R2
    
    ChatAPI --> Supabase
    AdminAPI --> Supabase
```

### æ¨¡çµ„æ¶æ§‹

```mermaid
graph LR
    subgraph "app/"
        A1[èªè­‰é é¢<br/>auth/]
        A2[ä¸»é é¢<br/>main/]
        A3[ç®¡ç†é é¢<br/>admin/]
        A4[API Routes<br/>api/]
    end
    
    subgraph "components/"
        C1[èªè­‰å…ƒä»¶<br/>auth/]
        C2[å°è©±å…ƒä»¶<br/>chat/]
        C3[å¼•å°å…ƒä»¶<br/>onboarding/]
        C4[ç®¡ç†å…ƒä»¶<br/>admin/]
    end
    
    subgraph "lib/"
        L1[èªè­‰å·¥å…·<br/>auth/]
        L2[MCP æ•´åˆ<br/>mcp/]
        L3[è³‡æ–™åº«<br/>supabase/]
        L4[å„²å­˜æœå‹™<br/>storage/]
        L5[Email æœå‹™<br/>email/]
        L6[é©—è­‰<br/>validation/]
        L7[Credits ç®¡ç†<br/>supabase/credits]
        L8[æ¨¡å‹å®šåƒ¹<br/>supabase/model-pricing]
    end
    
    A1 --> C1
    A2 --> C2
    A2 --> C3
    A3 --> C4
    
    A4 --> L1
    A4 --> L2
    A4 --> L3
    A4 --> L4
    A4 --> L5
    A4 --> L6
    A4 --> L7
    A4 --> L8
```

---

## è³‡æ–™æµ

### èªè­‰æµç¨‹

```mermaid
sequenceDiagram
    participant U as ä½¿ç”¨è€…
    participant F as å‰ç«¯é é¢
    participant A as API Route
    participant L as èªè­‰æ¨¡çµ„
    participant D as Supabase
    participant E as Email/Google
    
    Note over U,E: å¯†ç¢¼ç™»å…¥æµç¨‹
    U->>F: è¼¸å…¥ Email + å¯†ç¢¼
    F->>A: POST /api/auth/login
    A->>L: é©—è­‰å¯†ç¢¼
    L->>D: æŸ¥è©¢ç”¨æˆ¶
    D-->>L: è¿”å›ç”¨æˆ¶è³‡æ–™
    L->>L: æ¯”å°å¯†ç¢¼ (bcrypt)
    L->>L: ç”Ÿæˆ JWT Token
    L-->>A: è¿”å› Session
    A-->>F: è¨­å®š Cookie
    F-->>U: ç™»å…¥æˆåŠŸ
    
    Note over U,E: OTP ç™»å…¥æµç¨‹
    U->>F: è¼¸å…¥ Email
    F->>A: POST /api/auth/send-otp
    A->>L: ç”Ÿæˆ OTP
    L->>D: å„²å­˜ OTP
    L->>E: ç™¼é€ Email
    E-->>U: æ”¶åˆ° OTP
    U->>F: è¼¸å…¥ OTP
    F->>A: POST /api/auth/verify-otp
    A->>L: é©—è­‰ OTP
    L->>D: æª¢æŸ¥ OTP
    L->>L: ç”Ÿæˆ JWT Token
    L-->>A: è¿”å› Session
    A-->>F: è¨­å®š Cookie
    F-->>U: ç™»å…¥æˆåŠŸ
```

### å°è©±æµç¨‹

```mermaid
sequenceDiagram
    participant U as ä½¿ç”¨è€…
    participant F as å‰ç«¯é é¢
    participant A as Chat API
    participant S as Session é©—è­‰
    participant M as MCP Client
    participant AI as Anthropic API
    participant D as Supabase
    participant R2 as Cloudflare R2
    
    U->>F: è¼¸å…¥è¨Šæ¯/ä¸Šå‚³æª”æ¡ˆ
    F->>A: POST /api/chat
    A->>S: é©—è­‰ Session
    S-->>A: é©—è­‰é€šé
    
    alt æœ‰æª”æ¡ˆä¸Šå‚³
        A->>R2: ä¸Šå‚³æª”æ¡ˆ
        R2-->>A: è¿”å›æª”æ¡ˆ URL
    end
    
    A->>D: å„²å­˜ä½¿ç”¨è€…è¨Šæ¯
    A->>M: ç™¼é€è¨Šæ¯åˆ° AI
    M->>M: æ§‹å»ºç³»çµ±æç¤ºè©
    M->>M: è™•ç†åœ–ç‰‡ (base64)
    M->>AI: å‘¼å« Anthropic API
    AI-->>M: è¿”å› AI å›æ‡‰
    M-->>A: è¿”å›å›æ‡‰å…§å®¹
    A->>D: å„²å­˜ AI å›æ‡‰
    A-->>F: è¿”å›å®Œæ•´å°è©±
    F-->>U: é¡¯ç¤ºå›æ‡‰
```

### å·¥ä½œé‡ç´šåˆ¥èˆ‡ Skills æ˜ å°„

```mermaid
flowchart TD
    Start[ä½¿ç”¨è€…é¸æ“‡å·¥ä½œé‡ç´šåˆ¥] --> Check{å·¥ä½œé‡ç´šåˆ¥}
    
    Check -->|å³æ™‚| Instant[0 Skills<br/>ç›´æ¥å›æ‡‰]
    Check -->|åˆç´š| Basic[1 Skill<br/>åŸºç¤åˆ†æ]
    Check -->|æ¨™æº–| Standard[2-3 Skills<br/>æ¨™æº–åˆ†æ]
    Check -->|å°ˆæ¥­| Professional[4+ Skills<br/>å°ˆæ¥­åˆ†æ]
    
    Start2[ä½¿ç”¨è€…é¸æ“‡åŠŸèƒ½] --> Map{åŠŸèƒ½æ˜ å°„}
    Map -->|æª¢é©—| Lab[clinical-decision-support<br/>scientific-critical-thinking<br/>statistical-analysis]
    Map -->|æ”¾å°„| Radio[generate-image<br/>clinical-decision-support<br/>scientific-critical-thinking<br/>pydicom]
    Map -->|ç—…æ­·| Record[clinical-reports<br/>clinical-decision-support<br/>treatment-plans]
    Map -->|è—¥ç‰©| Med[drugbank-database<br/>clinpgx-database<br/>clinical-decision-support]
    
    Instant --> AI[Anthropic API]
    Basic --> Select1[é¸æ“‡ 1 å€‹ç›¸é—œ Skill]
    Standard --> Select3[é¸æ“‡ 2-3 å€‹ç›¸é—œ Skills]
    Professional --> Select5[é¸æ“‡ 4+ å€‹ç›¸é—œ Skills]
    
    Select1 --> AI
    Select3 --> AI
    Select5 --> AI
```

### Credits æ‰£é™¤æµç¨‹

```mermaid
sequenceDiagram
    participant U as ä½¿ç”¨è€…
    participant F as å‰ç«¯é é¢
    participant CreditsAPI as Credits API
    participant ChatAPI as èŠå¤© API
    participant DB as Supabase
    participant MCP as MCP Client

    U->>F: ç™»å…¥/è¼‰å…¥é é¢
    F->>CreditsAPI: GET /api/credits
    CreditsAPI->>DB: æŸ¥è©¢ customers.credits
    DB-->>CreditsAPI: è¿”å› credits åˆ†æ•¸
    CreditsAPI-->>F: è¿”å› credits
    F->>F: æ›´æ–° CreditsDisplay

    U->>F: é¸æ“‡æ¨¡å‹ä¸¦ç™¼é€è¨Šæ¯
    F->>ChatAPI: POST /api/chat (å« modelName)
    ChatAPI->>DB: æŸ¥è©¢ model_pricing
    DB-->>ChatAPI: è¿”å› credits_cost
    ChatAPI->>DB: æŸ¥è©¢ customers.credits
    DB-->>ChatAPI: è¿”å›ç•¶å‰ credits
    
    alt Credits è¶³å¤ 
        ChatAPI->>DB: æ‰£é™¤ credits
        ChatAPI->>DB: è¨˜éŒ„ credits_transactions
        ChatAPI->>MCP: å‘¼å« AI æ¨¡å‹
        MCP-->>ChatAPI: è¿”å›å›æ‡‰
        ChatAPI-->>F: è¿”å›æˆåŠŸ + æ–° credits
        F->>CreditsAPI: æ›´æ–° CreditsDisplay
    else Credits ä¸è¶³
        ChatAPI-->>F: è¿”å›éŒ¯èª¤ï¼ˆCredits ä¸è¶³ï¼‰
        F->>U: é¡¯ç¤ºéŒ¯èª¤æç¤º
    end
```

---

## æ ¸å¿ƒæ¨¡çµ„

### 1. èªè­‰æ¨¡çµ„ (`lib/auth/`)

| æª”æ¡ˆ | åŠŸèƒ½ |
|------|------|
| `session.ts` | JWT Session ç®¡ç†ï¼ˆç”Ÿæˆã€é©—è­‰ã€åˆ·æ–°ï¼‰ |
| `password.ts` | å¯†ç¢¼åŠ å¯†èˆ‡é©—è­‰ï¼ˆbcryptï¼‰ |
| `otp-generator.ts` | OTP ç”Ÿæˆèˆ‡é©—è­‰ |
| `google-oauth.ts` | Google OAuth é©—è­‰ |
| `admin.ts` | ç®¡ç†å“¡æ¬Šé™æª¢æŸ¥ |

**è¨­è¨ˆæ±ºç­–**ï¼š
- ä½¿ç”¨ JWT è€Œé Session Cookieï¼Œä¾¿æ–¼ç„¡ç‹€æ…‹æ“´å±•
- Session æœ‰æ•ˆæœŸ 7 å¤©ï¼Œå¹³è¡¡å®‰å…¨æ€§èˆ‡ä½¿ç”¨è€…é«”é©—
- OTP æœ‰æ•ˆæœŸ 10 åˆ†é˜ï¼Œé™ä½å®‰å…¨é¢¨éšª

### 2. MCP æ•´åˆæ¨¡çµ„ (`lib/mcp/`)

| æª”æ¡ˆ | åŠŸèƒ½ |
|------|------|
| `client.ts` | MCP Client å¯¦ä½œï¼ˆç›´æ¥ä½¿ç”¨ Anthropic APIï¼Œæ”¯æ´ modelName åƒæ•¸ï¼‰ |
| `workload.ts` | å·¥ä½œé‡ç´šåˆ¥é…ç½®èˆ‡ Skills æ•¸é‡è¨ˆç®— |
| `function-mapping.ts` | åŠŸèƒ½é¡å‹åˆ° Skills çš„æ˜ å°„ |
| `types.ts` | MCP ç›¸é—œé¡å‹å®šç¾© |

**è¨­è¨ˆæ±ºç­–**ï¼š
- **ç›´æ¥ä½¿ç”¨ Anthropic API**ï¼šä¸ä¾è³´ MCP Serverï¼Œæé«˜å¯é æ€§
- **å·¥ä½œé‡ç´šåˆ¥æ§åˆ¶**ï¼šæ ¹æ“šä½¿ç”¨è€…é¸æ“‡å‹•æ…‹èª¿æ•´ Skills æ•¸é‡
- **åŠŸèƒ½æ˜ å°„**ï¼šå°‡ä½¿ç”¨è€…é¸æ“‡çš„åŠŸèƒ½æ˜ å°„åˆ°ç›¸é—œçš„ AI Skills
- **åœ–ç‰‡è™•ç†**ï¼šè‡ªå‹•å°‡ä¸Šå‚³çš„åœ–ç‰‡è½‰æ›ç‚º base64 æ ¼å¼å‚³éçµ¦ AI
- **å¤šæ¨¡å‹æ”¯æ´**ï¼šæ ¹æ“š `modelName` åƒæ•¸é¸æ“‡å°æ‡‰çš„ Anthropic æ¨¡å‹ï¼ˆå¦‚ claude-sonnet-4-20250514ã€claude-3-haiku-20240307ï¼‰

### 3. è³‡æ–™åº«æ¨¡çµ„ (`lib/supabase/`)

| æª”æ¡ˆ | åŠŸèƒ½ |
|------|------|
| `client.ts` | Supabase å®¢æˆ¶ç«¯åˆå§‹åŒ– |
| `customers.ts` | å®¢æˆ¶ CRUD æ“ä½œ |
| `otp.ts` | OTP Token ç®¡ç† |
| `conversations.ts` | å°è©±è¨˜éŒ„ç®¡ç† |
| `messages.ts` | è¨Šæ¯ç®¡ç† |
| `credits.ts` | Credits ç®¡ç†ï¼ˆæŸ¥è©¢ã€æ‰£é™¤ã€å¢åŠ ã€æ­·å²è¨˜éŒ„ï¼‰ |
| `model-pricing.ts` | æ¨¡å‹å®šåƒ¹ç®¡ç†ï¼ˆæŸ¥è©¢ã€å»ºç«‹ã€æ›´æ–°ï¼‰ |

**è¨­è¨ˆæ±ºç­–**ï¼š
- ä½¿ç”¨ Supabase ä½œç‚º PostgreSQL çš„è¨—ç®¡æœå‹™
- æ‰€æœ‰è³‡æ–™åº«æ“ä½œéƒ½é€šé TypeScript å‡½æ•¸å°è£
- ä½¿ç”¨ç´¢å¼•å„ªåŒ–æŸ¥è©¢æ•ˆèƒ½
- Credits æ‰£é™¤æ¡ç”¨åŸå­æ€§æ“ä½œï¼Œç¢ºä¿è³‡æ–™ä¸€è‡´æ€§
- æ‰€æœ‰ Credits äº¤æ˜“éƒ½è¨˜éŒ„åœ¨ `credits_transactions` è¡¨ä¸­ï¼Œä¾¿æ–¼å¯©è¨ˆ

### 4. å„²å­˜æ¨¡çµ„ (`lib/storage/`)

| æª”æ¡ˆ | åŠŸèƒ½ |
|------|------|
| `upload.ts` | æª”æ¡ˆä¸Šå‚³åˆ° Cloudflare R2 |

**è¨­è¨ˆæ±ºç­–**ï¼š
- å¾ Supabase Storage é·ç§»åˆ° Cloudflare R2ï¼Œæå‡æ•ˆèƒ½èˆ‡æˆæœ¬æ•ˆç›Š
- æ”¯æ´è‡ªè¨‚å…¬é–‹ç¶²åŸŸ
- æª”æ¡ˆå¤§å°é™åˆ¶ 10MB
- æ”¯æ´æ ¼å¼ï¼šJPEGã€PDFã€DOCXã€TXT

### 5. é©—è­‰æ¨¡çµ„ (`lib/validation/`)

| æª”æ¡ˆ | åŠŸèƒ½ |
|------|------|
| `schemas.ts` | Zod é©—è­‰ Schema |

**è¨­è¨ˆæ±ºç­–**ï¼š
- ä½¿ç”¨ Zod é€²è¡Œé‹è¡Œæ™‚é©—è­‰
- æ‰€æœ‰ API è¼¸å…¥éƒ½ç¶“éé©—è­‰
- æä¾›æ¸…æ™°çš„éŒ¯èª¤è¨Šæ¯

---

## è³‡æ–™åº«è¨­è¨ˆ

### ER åœ–

```mermaid
erDiagram
    customers ||--o{ sessions : "has"
    customers ||--o{ chat_conversations : "creates"
    customers ||--o{ otp_tokens : "generates"
    customers ||--o{ credits_transactions : "has"
    chat_conversations ||--o{ chat_messages : "contains"
    chat_conversations ||--o{ credits_transactions : "references"
    
    customers {
        uuid id PK
        varchar email UK
        varchar name
        varchar phone
        varchar password_hash
        varchar auth_provider
        varchar oauth_id
        varchar approval_status
        varchar role
        integer credits
        timestamp created_at
        timestamp updated_at
        timestamp last_login_at
    }
    
    sessions {
        uuid id PK
        uuid customer_id FK
        text token
        timestamp expires_at
        varchar ip_address
        timestamp created_at
    }
    
    otp_tokens {
        uuid id PK
        varchar email
        varchar token
        boolean used
        timestamp expires_at
        timestamp created_at
    }
    
    chat_conversations {
        uuid id PK
        uuid customer_id FK
        varchar title
        varchar workload_level
        varchar selected_function
        varchar model_name
        timestamp created_at
        timestamp updated_at
    }
    
    model_pricing {
        uuid id PK
        varchar model_name UK
        varchar display_name
        integer credits_cost
        boolean is_active
        timestamp created_at
        timestamp updated_at
    }
    
    credits_transactions {
        uuid id PK
        uuid customer_id FK
        uuid conversation_id FK
        varchar model_name
        integer credits_cost
        integer credits_before
        integer credits_after
        timestamp created_at
    }
    
    chat_messages {
        uuid id PK
        uuid conversation_id FK
        varchar role
        text content
        text file_url
        varchar file_name
        varchar file_type
        timestamp created_at
    }
```

### è³‡æ–™è¡¨èªªæ˜

#### `customers` - å®¢æˆ¶è¡¨

| æ¬„ä½ | é¡å‹ | èªªæ˜ |
|------|------|------|
| `id` | UUID | ä¸»éµ |
| `email` | VARCHAR(255) | Emailï¼ˆå”¯ä¸€ï¼‰ |
| `name` | VARCHAR(255) | å§“å |
| `phone` | VARCHAR(50) | é›»è©±ï¼ˆå¯é¸ï¼‰ |
| `password_hash` | VARCHAR(255) | å¯†ç¢¼é›œæ¹Šï¼ˆå¯é¸ï¼‰ |
| `auth_provider` | VARCHAR(20) | èªè­‰æä¾›è€…ï¼špassword/otp/google |
| `oauth_id` | VARCHAR(255) | OAuth æä¾›è€…çš„ç”¨æˆ¶ ID |
| `approval_status` | VARCHAR(20) | å¯©æ ¸ç‹€æ…‹ï¼špending/approved/rejected |
| `role` | VARCHAR(20) | è§’è‰²ï¼šuser/admin |
| `credits` | INTEGER | Credits åˆ†æ•¸ï¼ˆé è¨­ 0ï¼‰ |
| `created_at` | TIMESTAMP | å»ºç«‹æ™‚é–“ |
| `updated_at` | TIMESTAMP | æ›´æ–°æ™‚é–“ |
| `last_login_at` | TIMESTAMP | æœ€å¾Œç™»å…¥æ™‚é–“ |

**ç´¢å¼•**ï¼š
- `idx_customers_email` - Email æŸ¥è©¢å„ªåŒ–
- `idx_customers_oauth_id` - OAuth ID æŸ¥è©¢å„ªåŒ–
- `idx_customers_approval_status` - å¯©æ ¸ç‹€æ…‹æŸ¥è©¢å„ªåŒ–
- `idx_customers_role` - è§’è‰²æŸ¥è©¢å„ªåŒ–

#### `sessions` - Session è¡¨

| æ¬„ä½ | é¡å‹ | èªªæ˜ |
|------|------|------|
| `id` | UUID | ä¸»éµ |
| `customer_id` | UUID | å®¢æˆ¶ IDï¼ˆå¤–éµï¼‰ |
| `token` | TEXT | JWT Token |
| `expires_at` | TIMESTAMP | éæœŸæ™‚é–“ |
| `ip_address` | VARCHAR(45) | IP åœ°å€ |
| `created_at` | TIMESTAMP | å»ºç«‹æ™‚é–“ |

**ç´¢å¼•**ï¼š
- `idx_sessions_customer_id` - å®¢æˆ¶æŸ¥è©¢å„ªåŒ–
- `idx_sessions_token` - Token æŸ¥è©¢å„ªåŒ–

#### `chat_conversations` - å°è©±è¡¨

| æ¬„ä½ | é¡å‹ | èªªæ˜ |
|------|------|------|
| `id` | UUID | ä¸»éµ |
| `customer_id` | UUID | å®¢æˆ¶ IDï¼ˆå¤–éµï¼‰ |
| `title` | VARCHAR(255) | å°è©±æ¨™é¡Œ |
| `workload_level` | VARCHAR(20) | å·¥ä½œé‡ç´šåˆ¥ï¼šinstant/basic/standard/professional |
| `selected_function` | VARCHAR(50) | é¸æ“‡çš„åŠŸèƒ½ï¼šlab/radiology/medical_record/medication |
| `model_name` | VARCHAR(255) | ä½¿ç”¨çš„ AI æ¨¡å‹åç¨± |
| `created_at` | TIMESTAMP | å»ºç«‹æ™‚é–“ |
| `updated_at` | TIMESTAMP | æ›´æ–°æ™‚é–“ |

**ç´¢å¼•**ï¼š
- `idx_chat_conversations_customer_id` - å®¢æˆ¶æŸ¥è©¢å„ªåŒ–

#### `chat_messages` - è¨Šæ¯è¡¨

| æ¬„ä½ | é¡å‹ | èªªæ˜ |
|------|------|------|
| `id` | UUID | ä¸»éµ |
| `conversation_id` | UUID | å°è©± IDï¼ˆå¤–éµï¼‰ |
| `role` | VARCHAR(20) | è§’è‰²ï¼šuser/assistant |
| `content` | TEXT | è¨Šæ¯å…§å®¹ |
| `file_url` | TEXT | æª”æ¡ˆ URLï¼ˆå¯é¸ï¼‰ |
| `file_name` | VARCHAR(255) | æª”æ¡ˆåç¨±ï¼ˆå¯é¸ï¼‰ |
| `file_type` | VARCHAR(50) | æª”æ¡ˆé¡å‹ï¼ˆå¯é¸ï¼‰ |
| `created_at` | TIMESTAMP | å»ºç«‹æ™‚é–“ |

**ç´¢å¼•**ï¼š
- `idx_chat_messages_conversation_id` - å°è©±æŸ¥è©¢å„ªåŒ–

#### `model_pricing` - æ¨¡å‹å®šåƒ¹è¡¨

| æ¬„ä½ | é¡å‹ | èªªæ˜ |
|------|------|------|
| `id` | UUID | ä¸»éµ |
| `model_name` | VARCHAR(255) | æ¨¡å‹åç¨±ï¼ˆå”¯ä¸€ï¼Œå¦‚ claude-sonnet-4-20250514ï¼‰ |
| `display_name` | VARCHAR(255) | é¡¯ç¤ºåç¨± |
| `credits_cost` | INTEGER | æ¯æ¬¡ä½¿ç”¨æ¶ˆè€—çš„é»æ•¸ |
| `is_active` | BOOLEAN | æ˜¯å¦å•Ÿç”¨ï¼ˆé è¨­ trueï¼‰ |
| `created_at` | TIMESTAMP | å»ºç«‹æ™‚é–“ |
| `updated_at` | TIMESTAMP | æ›´æ–°æ™‚é–“ |

**ç´¢å¼•**ï¼š
- `idx_model_pricing_model_name` - æ¨¡å‹åç¨±æŸ¥è©¢å„ªåŒ–
- `idx_model_pricing_is_active` - å•Ÿç”¨ç‹€æ…‹æŸ¥è©¢å„ªåŒ–

#### `credits_transactions` - Credits äº¤æ˜“è¨˜éŒ„è¡¨

| æ¬„ä½ | é¡å‹ | èªªæ˜ |
|------|------|------|
| `id` | UUID | ä¸»éµ |
| `customer_id` | UUID | å®¢æˆ¶ IDï¼ˆå¤–éµï¼‰ |
| `conversation_id` | UUID | å°è©± IDï¼ˆå¤–éµï¼Œå¯é¸ï¼‰ |
| `model_name` | VARCHAR(255) | ä½¿ç”¨çš„æ¨¡å‹åç¨± |
| `credits_cost` | INTEGER | æ¶ˆè€—çš„é»æ•¸ |
| `credits_before` | INTEGER | æ¶ˆè²»å‰é¤˜é¡ |
| `credits_after` | INTEGER | æ¶ˆè²»å¾Œé¤˜é¡ |
| `created_at` | TIMESTAMP | å»ºç«‹æ™‚é–“ |

**ç´¢å¼•**ï¼š
- `idx_credits_transactions_customer_id` - å®¢æˆ¶æŸ¥è©¢å„ªåŒ–
- `idx_credits_transactions_conversation_id` - å°è©±æŸ¥è©¢å„ªåŒ–
- `idx_credits_transactions_created_at` - æ™‚é–“æŸ¥è©¢å„ªåŒ–

#### å¯¦æ™‚åŒæ­¥èˆ‡å¿«å–æ”¿ç­–

ç‚ºäº†ç¢ºä¿å¾Œå°ç®¡ç†å“¡æ›´æ–°æ¨¡å‹ç‹€æ…‹æˆ–å®šåƒ¹æ™‚ï¼Œå‰å°ä½¿ç”¨è€…èƒ½å³æ™‚çœ‹åˆ°è®Šå‹•ï¼Œç³»çµ±å¯¦æ–½äº†ä»¥ä¸‹æ”¿ç­–ï¼š

1. **API å‹•æ…‹è·¯ç”±**ï¼š`/api/models` èˆ‡ `/api/admin/models` ä½¿ç”¨ `export const dynamic = 'force-dynamic'`ï¼Œåœç”¨ Next.js çš„éœæ…‹å„ªåŒ–èˆ‡å¿«å–ã€‚
2. **å‰ç«¯ä¸å¿«å–è«‹æ±‚**ï¼šå‰ç«¯ Fetch è«‹æ±‚ä½¿ç”¨ `{ cache: 'no-store' }`ï¼Œç¢ºä¿ç€è¦½å™¨ä¸è®€å–èˆŠè³‡æ–™ã€‚
3. **Supabase Realtime**ï¼šä½¿ç”¨ Supabase Realtime è¨‚é–± `model_pricing` è¡¨çš„è®Šå‹•ã€‚
4. **RLS æ”¿ç­–è€ƒé‡**ï¼š
   - ç‚ºäº†è®“ Realtime èƒ½æ­£å¸¸å·¥ä½œï¼Œå³ä¾¿æ¨¡å‹å·²åœç”¨ï¼ŒRLS æ”¿ç­–ä¹Ÿéœ€å…è¨±èªè­‰ä½¿ç”¨è€…è®€å–è©²ç­†è³‡æ–™ï¼ˆ`is_active = false` çš„è³‡æ–™å° Realtime è€Œè¨€å¿…é ˆæ˜¯ã€Œå¯è¦‹ã€çš„ï¼Œå¦å‰‡å®¢æˆ¶ç«¯æ”¶ä¸åˆ°è®Šå‹•é€šçŸ¥ï¼‰ã€‚
   - éæ¿¾é‚è¼¯ç”±æ‡‰ç”¨ç¨‹å¼å±¤ç´šï¼ˆAPIï¼‰è² è²¬ã€‚

---

## API æ¶æ§‹

### API ç«¯é»ç¸½è¦½

#### èªè­‰ API (`/api/auth/*`)

| æ–¹æ³• | è·¯å¾‘ | åŠŸèƒ½ | èªè­‰ |
|------|------|------|------|
| POST | `/api/auth/register` | è¨»å†Šï¼ˆå¯†ç¢¼/OTPï¼‰ | âŒ |
| POST | `/api/auth/login` | ç™»å…¥ï¼ˆå¯†ç¢¼/OTPï¼‰ | âŒ |
| POST | `/api/auth/send-otp` | ç™¼é€ OTP | âŒ |
| POST | `/api/auth/verify-otp` | é©—è­‰ OTP | âŒ |
| POST | `/api/auth/google` | Google OAuth | âŒ |
| POST | `/api/auth/logout` | ç™»å‡º | âœ… |
| GET | `/api/auth/me` | ç²å–ç•¶å‰ç”¨æˆ¶ | âœ… |
| GET | `/api/auth/admin-check` | æª¢æŸ¥ç®¡ç†å“¡æ¬Šé™ | âœ… |

#### å°è©± API

| æ–¹æ³• | è·¯å¾‘ | åŠŸèƒ½ | èªè­‰ |
|------|------|------|------|
| POST | `/api/chat` | ç™¼é€è¨Šæ¯ä¸¦å–å¾— AI å›æ‡‰ï¼ˆæ”¯æ´ modelNameï¼Œè‡ªå‹•æ‰£é™¤ Creditsï¼‰ | âœ… |
| GET | `/api/chat` | ç²å–å°è©±è¨Šæ¯ | âœ… |
| GET | `/api/conversations` | ç²å–å°è©±åˆ—è¡¨ | âœ… |

#### Credits API

| æ–¹æ³• | è·¯å¾‘ | åŠŸèƒ½ | èªè­‰ |
|------|------|------|------|
| GET | `/api/credits` | å–å¾—ç•¶å‰ç”¨æˆ¶çš„ Credits åˆ†æ•¸ | âœ… |
| GET | `/api/credits/history` | å–å¾—æ¶ˆè²»æ­·å²è¨˜éŒ„ | âœ… |
| GET | `/api/models` | å–å¾—æ‰€æœ‰å•Ÿç”¨çš„æ¨¡å‹åˆ—è¡¨ | âœ… |

#### ç®¡ç† API (`/api/admin/*`)

| æ–¹æ³• | è·¯å¾‘ | åŠŸèƒ½ | èªè­‰ |
|------|------|------|------|
| GET | `/api/admin/customers` | ç²å–å®¢æˆ¶åˆ—è¡¨ | âœ… Admin |
| POST | `/api/admin/approve` | å¯©æ ¸é€šé | âœ… Admin |
| POST | `/api/admin/reject` | å¯©æ ¸æ‹’çµ• | âœ… Admin |
| GET | `/api/admin/models` | å–å¾—æ‰€æœ‰æ¨¡å‹åˆ—è¡¨ï¼ˆå«åœç”¨ï¼‰ | âœ… Admin |
| POST | `/api/admin/models` | å»ºç«‹æ–°æ¨¡å‹ | âœ… Admin |
| PUT | `/api/admin/models/:modelName` | æ›´æ–°æ¨¡å‹å®šåƒ¹ | âœ… Admin |
| DELETE | `/api/admin/models/:modelName` | åœç”¨æ¨¡å‹ | âœ… Admin |
| POST | `/api/admin/credits/add` | ç‚ºç”¨æˆ¶å¢åŠ  Credits | âœ… Admin |

### API å›æ‡‰æ ¼å¼

#### æˆåŠŸå›æ‡‰

```typescript
{
  success: true,
  data: {
    // å›æ‡‰è³‡æ–™
  }
}
```

#### éŒ¯èª¤å›æ‡‰

```typescript
{
  success: false,
  error: "éŒ¯èª¤è¨Šæ¯"
}
```

### Rate Limiting

æ‰€æœ‰èªè­‰ç›¸é—œ API éƒ½å¯¦æ–½ Rate Limitingï¼š
- **è¨˜æ†¶é«”å„²å­˜**ï¼šé–‹ç™¼ç’°å¢ƒä½¿ç”¨è¨˜æ†¶é«”ï¼Œç”Ÿç”¢ç’°å¢ƒå»ºè­°ä½¿ç”¨ Redis
- **é™åˆ¶è¦å‰‡**ï¼š
  - ç™»å…¥/è¨»å†Šï¼šæ¯ IP æ¯ 15 åˆ†é˜ 5 æ¬¡
  - OTP ç™¼é€ï¼šæ¯ Email æ¯ 15 åˆ†é˜ 3 æ¬¡
  - OTP é©—è­‰ï¼šæ¯ Email æ¯ 15 åˆ†é˜ 10 æ¬¡

---

## å®‰å…¨æ€§æ¶æ§‹

### èªè­‰èˆ‡æˆæ¬Š

```mermaid
flowchart TD
    Start[ä½¿ç”¨è€…è«‹æ±‚] --> Check{æ˜¯å¦æœ‰ Session Cookie?}
    Check -->|ç„¡| Redirect[é‡å°å‘åˆ°ç™»å…¥é ]
    Check -->|æœ‰| Verify[é©—è­‰ JWT Token]
    Verify -->|ç„¡æ•ˆ| Redirect
    Verify -->|æœ‰æ•ˆ| CheckExpiry{Token æ˜¯å¦éæœŸ?}
    CheckExpiry -->|éæœŸ| Redirect
    CheckExpiry -->|æœ‰æ•ˆ| CheckApproval{å¸³è™Ÿæ˜¯å¦å·²å¯©æ ¸?}
    CheckApproval -->|æœªå¯©æ ¸| Block[æ‹’çµ•å­˜å–]
    CheckApproval -->|å·²å¯©æ ¸| CheckRole{éœ€è¦ç®¡ç†å“¡æ¬Šé™?}
    CheckRole -->|æ˜¯| CheckAdmin{æ˜¯å¦ç‚ºç®¡ç†å“¡?}
    CheckAdmin -->|å¦| Block
    CheckAdmin -->|æ˜¯| Allow[å…è¨±å­˜å–]
    CheckRole -->|å¦| Allow
```

### å®‰å…¨æªæ–½

1. **å¯†ç¢¼åŠ å¯†**ï¼šä½¿ç”¨ bcryptï¼ˆsalt rounds: 10ï¼‰
2. **JWT Token**ï¼šä½¿ç”¨ HS256 æ¼”ç®—æ³•ï¼Œæœ‰æ•ˆæœŸ 7 å¤©
3. **Session ç®¡ç†**ï¼šToken å„²å­˜åœ¨ HttpOnly Cookie ä¸­
4. **Rate Limiting**ï¼šé˜²æ­¢æš´åŠ›ç ´è§£æ”»æ“Š
5. **è¼¸å…¥é©—è­‰**ï¼šæ‰€æœ‰ API è¼¸å…¥éƒ½ç¶“é Zod é©—è­‰
6. **SQL æ³¨å…¥é˜²è­·**ï¼šä½¿ç”¨ Supabase åƒæ•¸åŒ–æŸ¥è©¢
7. **XSS é˜²è­·**ï¼šReact è‡ªå‹•è½‰ç¾©
8. **CSRF é˜²è­·**ï¼šSameSite Cookie è¨­å®š

---

## éƒ¨ç½²æ¶æ§‹

### Vercel éƒ¨ç½²æ¶æ§‹

```mermaid
flowchart TB
    subgraph "Vercel Platform"
        Edge[Edge Network]
        Functions[Serverless Functions]
        Build[Build System]
    end
    
    subgraph "External Services"
        Supabase[(Supabase<br/>PostgreSQL)]
        Anthropic[Anthropic API]
        Google[Google OAuth]
        Resend[Resend Email]
        R2[Cloudflare R2]
    end
    
    User[ä½¿ç”¨è€…] --> Edge
    Edge --> Functions
    Functions --> Supabase
    Functions --> Anthropic
    Functions --> Google
    Functions --> Resend
    Functions --> R2
    
    Build --> Functions
```

### ç’°å¢ƒè®Šæ•¸ç®¡ç†

- **é–‹ç™¼ç’°å¢ƒ**ï¼š`.env.local`ï¼ˆä¸æäº¤åˆ° Gitï¼‰
- **ç”Ÿç”¢ç’°å¢ƒ**ï¼šVercel Dashboard â†’ Environment Variables
- **å®‰å…¨æ€§æª¢æŸ¥**ï¼š`npm run check:env` è…³æœ¬é©—è­‰

### éƒ¨ç½²æµç¨‹

1. **ä»£ç¢¼æäº¤**ï¼šæ¨é€åˆ° GitHub
2. **è‡ªå‹•è§¸ç™¼**ï¼šVercel åµæ¸¬åˆ°æ¨é€
3. **å»ºç½®**ï¼šåŸ·è¡Œ `npm run build`
4. **éƒ¨ç½²**ï¼šéƒ¨ç½²åˆ° Edge Network
5. **é©—è­‰**ï¼šæª¢æŸ¥ç’°å¢ƒè®Šæ•¸èˆ‡åŠŸèƒ½

---

## æ•ˆèƒ½å„ªåŒ–

### å‰ç«¯å„ªåŒ–

- âœ… **Next.js App Router**ï¼šè‡ªå‹•ç¨‹å¼ç¢¼åˆ†å‰²
- âœ… **Tailwind CSS**ï¼šåƒ…è¼‰å…¥ä½¿ç”¨çš„æ¨£å¼
- âœ… **åœ–ç‰‡å„ªåŒ–**ï¼šNext.js Image å…ƒä»¶ï¼ˆæœªä¾†å¯æ“´å±•ï¼‰

### å¾Œç«¯å„ªåŒ–

- âœ… **è³‡æ–™åº«ç´¢å¼•**ï¼šæ‰€æœ‰æŸ¥è©¢æ¬„ä½éƒ½æœ‰ç´¢å¼•
- âœ… **é€£ç·šæ± **ï¼šSupabase è‡ªå‹•ç®¡ç†
- âœ… **å¿«å–ç­–ç•¥**ï¼šSession é©—è­‰çµæœå¯å¿«å–ï¼ˆæœªä¾†å¯æ“´å±•ï¼‰

### å·²çŸ¥é™åˆ¶èˆ‡æœªä¾†å„ªåŒ–

1. **Rate Limiting**ï¼šç›®å‰ä½¿ç”¨è¨˜æ†¶é«”ï¼Œå»ºè­°é·ç§»åˆ° Redis
2. **SSE ä¸²æµ**ï¼šç›®å‰æ˜¯å®Œæ•´å›æ‡‰ï¼Œæœªä¾†å¯å¯¦ä½œçœŸæ­£çš„ä¸²æµ
3. **åœ–ç‰‡è™•ç†**ï¼šå¤§åœ–ç‰‡æœƒå¢åŠ  API è«‹æ±‚å¤§å°ï¼Œå»ºè­°é™åˆ¶åœ–ç‰‡å°ºå¯¸
4. **å¿«å–æ©Ÿåˆ¶**ï¼šAPI å·²é‡å°æ¨¡å‹è³‡æ–™å¯¦æ–½ `force-dynamic`ï¼Œç¢ºä¿å³æ™‚æ€§ã€‚

---

## æ“´å±•æ€§è€ƒé‡

### æ°´å¹³æ“´å±•

- âœ… **ç„¡ç‹€æ…‹è¨­è¨ˆ**ï¼šæ‰€æœ‰ API éƒ½æ˜¯ç„¡ç‹€æ…‹çš„
- âœ… **Serverless**ï¼šVercel Functions è‡ªå‹•æ“´å±•
- âœ… **è³‡æ–™åº«**ï¼šSupabase è‡ªå‹•æ“´å±•

### å‚ç›´æ“´å±•

- âœ… **è³‡æ–™åº«å„ªåŒ–**ï¼šç´¢å¼•èˆ‡æŸ¥è©¢å„ªåŒ–
- âœ… **API å„ªåŒ–**ï¼šæ¸›å°‘ä¸å¿…è¦çš„è³‡æ–™åº«æŸ¥è©¢

---

## ç›£æ§èˆ‡æ—¥èªŒ

### æ—¥èªŒè¨˜éŒ„

- **é–‹ç™¼ç’°å¢ƒ**ï¼šConsole æ—¥èªŒ
- **ç”Ÿç”¢ç’°å¢ƒ**ï¼šVercel Functions æ—¥èªŒ

### ç›£æ§é …ç›®

- API å›æ‡‰æ™‚é–“
- éŒ¯èª¤ç‡
- è³‡æ–™åº«æŸ¥è©¢æ•ˆèƒ½
- æª”æ¡ˆä¸Šå‚³æˆåŠŸç‡

---

## åƒè€ƒæ–‡ä»¶

- [README.md](./README.md) - å°ˆæ¡ˆèªªæ˜
- [SPECIFICATIONS.md](./SPECIFICATIONS.md) - ç³»çµ±è¦æ ¼
- [DEPLOYMENT_GUIDE.md](./DEPLOYMENT_GUIDE.md) - éƒ¨ç½²æŒ‡å—
- [ENV_VARIABLES.md](./ENV_VARIABLES.md) - ç’°å¢ƒè®Šæ•¸èªªæ˜

---

---

## Credits ç³»çµ±èˆ‡æ¨¡å‹ç®¡ç†

### ç³»çµ±æ¦‚è¿°

Credits ç³»çµ±æä¾›é»æ•¸ç®¡ç†æ©Ÿåˆ¶ï¼Œç”¨æ–¼æ§åˆ¶ AI æ¨¡å‹çš„ä½¿ç”¨æˆæœ¬ã€‚ç³»çµ±æ”¯æ´å¤šç¨® AI æ¨¡å‹ï¼Œæ¯å€‹æ¨¡å‹æœ‰ä¸åŒçš„å®šåƒ¹ï¼Œä½¿ç”¨è€…åœ¨ä½¿ç”¨å‰éœ€è¦ç¢ºä¿æœ‰è¶³å¤ çš„ Creditsã€‚

### æ ¸å¿ƒåŠŸèƒ½

1. **Credits ç®¡ç†**
   - æŸ¥è©¢ç•¶å‰é¤˜é¡
   - æ‰£é™¤ Creditsï¼ˆä½¿ç”¨ AI æ¨¡å‹æ™‚ï¼‰
   - å¢åŠ  Creditsï¼ˆç®¡ç†å“¡æ“ä½œï¼‰
   - äº¤æ˜“æ­·å²è¨˜éŒ„

2. **æ¨¡å‹å®šåƒ¹ç®¡ç†**
   - æ”¯æ´å¤šç¨® AI æ¨¡å‹
   - æ¯å€‹æ¨¡å‹æœ‰ç¨ç«‹çš„å®šåƒ¹
   - ç®¡ç†å“¡å¯å‹•æ…‹èª¿æ•´å®šåƒ¹
   - æ¨¡å‹å•Ÿç”¨/åœç”¨æ§åˆ¶

3. **å‰ç«¯æ•´åˆ**
   - Credits é¡¯ç¤ºå…ƒä»¶ï¼ˆ`CreditsDisplay.tsx`ï¼‰
   - æ¨¡å‹é¸æ“‡å™¨å…ƒä»¶ï¼ˆ`ModelSelector.tsx`ï¼‰
   - è‡ªå‹•æª¢æŸ¥ Credits é¤˜é¡
   - ä¸è¶³æ™‚é¡¯ç¤ºéŒ¯èª¤æç¤º

### è³‡æ–™æµç¨‹

1. **ç™»å…¥æ™‚æŸ¥è©¢ Credits**ï¼šä½¿ç”¨è€…ç™»å…¥å¾Œï¼Œç³»çµ±è‡ªå‹•æŸ¥è©¢ä¸¦è¿”å› Credits åˆ†æ•¸
2. **ä½¿ç”¨å‰æª¢æŸ¥**ï¼šç™¼é€è¨Šæ¯å‰æª¢æŸ¥ Credits æ˜¯å¦è¶³å¤ 
3. **æ‰£é™¤èˆ‡è¨˜éŒ„**ï¼šä½¿ç”¨æˆåŠŸå¾Œæ‰£é™¤ Credits ä¸¦è¨˜éŒ„äº¤æ˜“
4. **å³æ™‚æ›´æ–°**ï¼šå‰ç«¯å³æ™‚æ›´æ–° Credits é¡¯ç¤º

### é è¨­æ¨¡å‹å®šåƒ¹

| æ¨¡å‹åç¨± | é¡¯ç¤ºåç¨± | Credits æ¶ˆè€— |
|---------|---------|-------------|
| `claude-sonnet-4-20250514` | Claude Sonnet 4 | 10 é» |
| `claude-3-haiku-20240307` | Claude 3 Haiku | 5 é» |

### æ¸¬è©¦ç­–ç•¥

ç³»çµ±æ¡ç”¨ **TDDï¼ˆTest-Driven Developmentï¼‰** é–‹ç™¼æ¨¡å¼ï¼š

- **å–®å…ƒæ¸¬è©¦**ï¼šä½¿ç”¨ Vitest æ¸¬è©¦æ‰€æœ‰å¾Œç«¯å‡½æ•¸
- **æ•´åˆæ¸¬è©¦**ï¼šæ¸¬è©¦å®Œæ•´æµç¨‹ï¼ˆé¸æ“‡æ¨¡å‹ â†’ ç™¼é€ â†’ æ‰£é™¤ Creditsï¼‰
- **å…ƒä»¶æ¸¬è©¦**ï¼šä½¿ç”¨ @testing-library/react æ¸¬è©¦å‰ç«¯å…ƒä»¶
- **æ¸¬è©¦è¦†è“‹ç‡ç›®æ¨™**ï¼šé—œéµé‚è¼¯ 100%ï¼Œæ•´é«” â‰¥ 90%

è©³ç´°æ¸¬è©¦è¨ˆåŠƒè«‹åƒè€ƒ `credits_ç³»çµ±èˆ‡æ¨¡å‹ç®¡ç†.plan.md`ã€‚

---

**æ–‡ä»¶ç¶­è­·è€…**ï¼šé–‹ç™¼åœ˜éšŠ  
**æœ€å¾Œå¯©æŸ¥æ—¥æœŸ**ï¼š2026-01-29
