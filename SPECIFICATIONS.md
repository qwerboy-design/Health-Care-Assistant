# ğŸ“‹ ç³»çµ±è¦æ ¼æ–‡ä»¶

> æœ€å¾Œæ›´æ–°ï¼š2026-01-29  
> ç‰ˆæœ¬ï¼šv1.1.1

## ğŸ“‹ ç›®éŒ„

1. [åŠŸèƒ½è¦æ ¼](#åŠŸèƒ½è¦æ ¼)
2. [API è¦æ ¼](#api-è¦æ ¼)
3. [è³‡æ–™åº«è¦æ ¼](#è³‡æ–™åº«è¦æ ¼)
4. [UI/UX è¦æ ¼](#uiux-è¦æ ¼)
5. [å®‰å…¨æ€§è¦æ ¼](#å®‰å…¨æ€§è¦æ ¼)
6. [æ•ˆèƒ½è¦æ ¼](#æ•ˆèƒ½è¦æ ¼)

---

## åŠŸèƒ½è¦æ ¼

### 1. èªè­‰ç³»çµ±

#### 1.1 è¨»å†ŠåŠŸèƒ½

**åŠŸèƒ½æè¿°**ï¼šä½¿ç”¨è€…å¯ä»¥é€éä¸‰ç¨®æ–¹å¼è¨»å†Šå¸³è™Ÿ

**æ”¯æ´æ–¹å¼**ï¼š
1. **å¯†ç¢¼è¨»å†Š**
   - Email + å¯†ç¢¼
   - å¯†ç¢¼é•·åº¦ï¼šè‡³å°‘ 8 å€‹å­—å…ƒ
   - å¯†ç¢¼åŠ å¯†ï¼šbcryptï¼ˆsalt rounds: 10ï¼‰

2. **OTP è¨»å†Š**
   - Email ç™¼é€ 6 ä½æ•¸é©—è­‰ç¢¼
   - OTP æœ‰æ•ˆæœŸï¼š10 åˆ†é˜
   - æ¯å€‹ Email æ¯ 15 åˆ†é˜æœ€å¤š 3 æ¬¡è«‹æ±‚

3. **Google OAuth è¨»å†Š**
   - ä½¿ç”¨ Google Identity Services
   - è‡ªå‹•å»ºç«‹å¸³è™Ÿæˆ–ç¶å®šç¾æœ‰å¸³è™Ÿ

**æ¥­å‹™è¦å‰‡**ï¼š
- æ–°è¨»å†Šå¸³è™Ÿé è¨­ç‹€æ…‹ç‚º `pending`ï¼ˆå¾…å¯©æ ¸ï¼‰
- åªæœ‰ç®¡ç†å“¡å¯ä»¥å¯©æ ¸å¸³è™Ÿ
- æœªå¯©æ ¸å¸³è™Ÿç„¡æ³•ä½¿ç”¨å°è©±åŠŸèƒ½

#### 1.2 ç™»å…¥åŠŸèƒ½

**åŠŸèƒ½æè¿°**ï¼šä½¿ç”¨è€…å¯ä»¥é€éä¸‰ç¨®æ–¹å¼ç™»å…¥

**æ”¯æ´æ–¹å¼**ï¼š
1. **å¯†ç¢¼ç™»å…¥**
   - Email + å¯†ç¢¼
   - é©—è­‰å¤±æ•— 5 æ¬¡å¾Œé–å®š 15 åˆ†é˜ï¼ˆRate Limitingï¼‰

2. **OTP ç™»å…¥**
   - Email ç™¼é€ 6 ä½æ•¸é©—è­‰ç¢¼
   - OTP æœ‰æ•ˆæœŸï¼š10 åˆ†é˜
   - æ¯å€‹ Email æ¯ 15 åˆ†é˜æœ€å¤š 10 æ¬¡é©—è­‰å˜—è©¦

3. **Google OAuth ç™»å…¥**
   - ä¸€éµç™»å…¥
   - è‡ªå‹•ç¶å®šæˆ–å»ºç«‹å¸³è™Ÿ

**Session ç®¡ç†**ï¼š
- JWT Token æœ‰æ•ˆæœŸï¼š7 å¤©
- Token å„²å­˜åœ¨ HttpOnly Cookie
- è‡ªå‹•åˆ·æ–°æ©Ÿåˆ¶ï¼ˆæœªä¾†å¯æ“´å±•ï¼‰

#### 1.3 ç™»å‡ºåŠŸèƒ½

**åŠŸèƒ½æè¿°**ï¼šä½¿ç”¨è€…ç™»å‡ºä¸¦æ¸…é™¤ Session

**å¯¦ä½œ**ï¼š
- æ¸…é™¤ Server ç«¯ Session è¨˜éŒ„
- æ¸…é™¤ Client ç«¯ Cookie

---

### 2. å°è©±ç³»çµ±

#### 2.1 å°è©±å»ºç«‹

**åŠŸèƒ½æè¿°**ï¼šä½¿ç”¨è€…å¯ä»¥å»ºç«‹æ–°å°è©±æˆ–ç¹¼çºŒç¾æœ‰å°è©±

**è¼¸å…¥åƒæ•¸**ï¼š
- `message`ï¼šæ–‡å­—è¨Šæ¯ï¼ˆå¯é¸ï¼Œå¦‚æœæœ‰æª”æ¡ˆï¼‰
- `file`ï¼šä¸Šå‚³çš„æª”æ¡ˆï¼ˆå¯é¸ï¼‰
- `workloadLevel`ï¼šå·¥ä½œé‡ç´šåˆ¥ï¼ˆå¿…å¡«ï¼‰
  - `instant`ï¼šå³æ™‚å›æ‡‰ï¼Œ0 Skills
  - `basic`ï¼šåˆç´šåˆ†æï¼Œ1 Skill
  - `standard`ï¼šæ¨™æº–åˆ†æï¼Œ2-3 Skills
  - `professional`ï¼šå°ˆæ¥­åˆ†æï¼Œ4+ Skills
- `selectedFunction`ï¼šåŠŸèƒ½é¸æ“‡ï¼ˆå¯é¸ï¼‰
  - `lab`ï¼šæª¢é©—å ±å‘Šåˆ†æ
  - `radiology`ï¼šæ”¾å°„å½±åƒåˆ†æ
  - `medical_record`ï¼šç—…æ­·è³‡æ–™åˆ†æ
  - `medication`ï¼šè—¥ç‰©ç›¸é—œåˆ†æ
- `conversationId`ï¼šå°è©± IDï¼ˆå¯é¸ï¼Œç¹¼çºŒç¾æœ‰å°è©±ï¼‰

**æ¥­å‹™è¦å‰‡**ï¼š
- è¨Šæ¯æˆ–æª”æ¡ˆè‡³å°‘éœ€è¦ä¸€å€‹
- æª”æ¡ˆå¤§å°é™åˆ¶ï¼š10MB
- æ”¯æ´æª”æ¡ˆæ ¼å¼ï¼šJPEGã€PDFã€DOCXã€TXT
- åœ–ç‰‡æœƒè‡ªå‹•è½‰æ›ç‚º base64 æ ¼å¼å‚³éçµ¦ AI

#### 2.2 AI å›æ‡‰ç”Ÿæˆ

**åŠŸèƒ½æè¿°**ï¼šæ ¹æ“šä½¿ç”¨è€…è¼¸å…¥ç”Ÿæˆ AI å›æ‡‰

**è™•ç†æµç¨‹**ï¼š
1. é©—è­‰ä½¿ç”¨è€… Session
2. ä¸Šå‚³æª”æ¡ˆï¼ˆå¦‚æœæœ‰ï¼‰åˆ° Cloudflare R2
3. å„²å­˜ä½¿ç”¨è€…è¨Šæ¯åˆ°è³‡æ–™åº«
4. æ§‹å»ºç³»çµ±æç¤ºè©ï¼ˆæ ¹æ“šå·¥ä½œé‡ç´šåˆ¥å’ŒåŠŸèƒ½é¸æ“‡ï¼‰
5. é¸æ“‡ç›¸é—œçš„ Skillsï¼ˆæ ¹æ“šåŠŸèƒ½æ˜ å°„ï¼‰
6. å‘¼å« Anthropic API
7. å„²å­˜ AI å›æ‡‰åˆ°è³‡æ–™åº«
8. è¿”å›å®Œæ•´å°è©±

**Skills æ˜ å°„è¦å‰‡**ï¼š

| åŠŸèƒ½ | å»ºè­°çš„ Skills |
|------|---------------|
| `lab` | clinical-decision-support, scientific-critical-thinking, statistical-analysis |
| `radiology` | generate-image, clinical-decision-support, scientific-critical-thinking, pydicom |
| `medical_record` | clinical-reports, clinical-decision-support, treatment-plans |
| `medication` | drugbank-database, clinpgx-database, clinical-decision-support |

**å·¥ä½œé‡ç´šåˆ¥èˆ‡ Skills æ•¸é‡**ï¼š

| ç´šåˆ¥ | Skills æ•¸é‡ |
|------|-------------|
| `instant` | 0 |
| `basic` | 1 |
| `standard` | 2-3 |
| `professional` | 4+ |

#### 2.3 å°è©±æ­·å²

**åŠŸèƒ½æè¿°**ï¼šä½¿ç”¨è€…å¯ä»¥æŸ¥çœ‹æ‰€æœ‰å°è©±è¨˜éŒ„

**åŠŸèƒ½**ï¼š
- åˆ—å‡ºæ‰€æœ‰å°è©±ï¼ˆæŒ‰æ›´æ–°æ™‚é–“æ’åºï¼‰
- é»æ“Šå°è©±ç¹¼çºŒå°è©±
- é¡¯ç¤ºå°è©±æ¨™é¡Œã€å»ºç«‹æ™‚é–“ã€æœ€å¾Œæ›´æ–°æ™‚é–“

---

### 3. ç®¡ç†å“¡ç³»çµ±

#### 3.1 å¸³è™Ÿå¯©æ ¸

**åŠŸèƒ½æè¿°**ï¼šç®¡ç†å“¡å¯ä»¥å¯©æ ¸ä½¿ç”¨è€…å¸³è™Ÿ

**åŠŸèƒ½**ï¼š
- æŸ¥çœ‹å¾…å¯©æ ¸å¸³è™Ÿåˆ—è¡¨
- å¯©æ ¸é€šéï¼ˆ`approval_status: 'approved'`ï¼‰
- å¯©æ ¸æ‹’çµ•ï¼ˆ`approval_status: 'rejected'`ï¼‰

**æ¬Šé™**ï¼š
- åªæœ‰ `role: 'admin'` çš„ä½¿ç”¨è€…å¯ä»¥å­˜å–
- æ‰€æœ‰ç®¡ç† API éƒ½éœ€è¦ç®¡ç†å“¡æ¬Šé™é©—è­‰

#### 3.2 å®¢æˆ¶ç®¡ç†

**åŠŸèƒ½æè¿°**ï¼šç®¡ç†å“¡å¯ä»¥æŸ¥çœ‹æ‰€æœ‰å®¢æˆ¶

**åŠŸèƒ½**ï¼š
- åˆ—å‡ºæ‰€æœ‰å®¢æˆ¶
- æŸ¥çœ‹å®¢æˆ¶è©³ç´°è³‡è¨Š
- æŸ¥çœ‹å®¢æˆ¶å¯©æ ¸ç‹€æ…‹

---

## API è¦æ ¼

### èªè­‰ API

#### POST `/api/auth/register`

**åŠŸèƒ½**ï¼šè¨»å†Šæ–°å¸³è™Ÿ

**è«‹æ±‚æ ¼å¼**ï¼š
```typescript
// å¯†ç¢¼è¨»å†Š
{
  email: string;
  password: string;
  name: string;
  phone?: string;
  authType: 'password';
}

// OTP è¨»å†Š
{
  email: string;
  name: string;
  phone?: string;
  authType: 'otp';
  otp: string;
}
```

**å›æ‡‰æ ¼å¼**ï¼š
```typescript
{
  success: true;
  data: {
    customer: Customer;
    session: {
      token: string;
      expiresAt: string;
    };
  };
}
```

**éŒ¯èª¤å›æ‡‰**ï¼š
```typescript
{
  success: false;
  error: string;
}
```

#### POST `/api/auth/login`

**åŠŸèƒ½**ï¼šç™»å…¥

**è«‹æ±‚æ ¼å¼**ï¼š
```typescript
// å¯†ç¢¼ç™»å…¥
{
  email: string;
  password: string;
  authType: 'password';
}

// OTP ç™»å…¥
{
  email: string;
  otp: string;
  authType: 'otp';
}
```

**å›æ‡‰æ ¼å¼**ï¼šåŒè¨»å†Š API

#### POST `/api/auth/send-otp`

**åŠŸèƒ½**ï¼šç™¼é€ OTP é©—è­‰ç¢¼

**è«‹æ±‚æ ¼å¼**ï¼š
```typescript
{
  email: string;
}
```

**å›æ‡‰æ ¼å¼**ï¼š
```typescript
{
  success: true;
  message: string;
}
```

**Rate Limiting**ï¼šæ¯ Email æ¯ 15 åˆ†é˜æœ€å¤š 3 æ¬¡

#### POST `/api/auth/verify-otp`

**åŠŸèƒ½**ï¼šé©—è­‰ OTP

**è«‹æ±‚æ ¼å¼**ï¼š
```typescript
{
  email: string;
  otp: string;
}
```

**å›æ‡‰æ ¼å¼**ï¼šåŒç™»å…¥ API

#### POST `/api/auth/google`

**åŠŸèƒ½**ï¼šGoogle OAuth ç™»å…¥/è¨»å†Š

**è«‹æ±‚æ ¼å¼**ï¼š
```typescript
{
  credential: string; // Google ID Token
}
```

**å›æ‡‰æ ¼å¼**ï¼šåŒç™»å…¥ API

#### POST `/api/auth/logout`

**åŠŸèƒ½**ï¼šç™»å‡º

**èªè­‰**ï¼šéœ€è¦ Session Cookie

**å›æ‡‰æ ¼å¼**ï¼š
```typescript
{
  success: true;
  message: string;
}
```

#### GET `/api/auth/me`

**åŠŸèƒ½**ï¼šç²å–ç•¶å‰ä½¿ç”¨è€…è³‡è¨Š

**èªè­‰**ï¼šéœ€è¦ Session Cookie

**å›æ‡‰æ ¼å¼**ï¼š
```typescript
{
  success: true;
  data: {
    customer: Customer;
  };
}
```

### å°è©± API

#### POST `/api/chat`

**åŠŸèƒ½**ï¼šç™¼é€è¨Šæ¯ä¸¦å–å¾— AI å›æ‡‰

**èªè­‰**ï¼šéœ€è¦ Session Cookie

**è«‹æ±‚æ ¼å¼**ï¼š`FormData`
```
message: string (å¯é¸)
file: File (å¯é¸)
workloadLevel: 'instant' | 'basic' | 'standard' | 'professional'
selectedFunction?: 'lab' | 'radiology' | 'medical_record' | 'medication'
conversationId?: string
```

**å›æ‡‰æ ¼å¼**ï¼š
```typescript
{
  success: true;
  data: {
    conversation: Conversation;
    message: Message;
    response: Message;
  };
}
```

**éŒ¯èª¤å›æ‡‰**ï¼š
```typescript
{
  success: false;
  error: string;
}
```

#### GET `/api/chat`

**åŠŸèƒ½**ï¼šç²å–å°è©±è¨Šæ¯

**èªè­‰**ï¼šéœ€è¦ Session Cookie

**æŸ¥è©¢åƒæ•¸**ï¼š
- `conversationId`: string (å¿…å¡«)

**å›æ‡‰æ ¼å¼**ï¼š
```typescript
{
  success: true;
  data: {
    conversation: Conversation;
    messages: Message[];
  };
}
```

#### GET `/api/conversations`

**åŠŸèƒ½**ï¼šç²å–å°è©±åˆ—è¡¨

**èªè­‰**ï¼šéœ€è¦ Session Cookie

**å›æ‡‰æ ¼å¼**ï¼š
```typescript
{
  success: true;
  data: {
    conversations: Conversation[];
  };
}
```

### ç®¡ç† API

#### GET `/api/admin/customers`

**åŠŸèƒ½**ï¼šç²å–å®¢æˆ¶åˆ—è¡¨

**èªè­‰**ï¼šéœ€è¦ç®¡ç†å“¡æ¬Šé™

**æŸ¥è©¢åƒæ•¸**ï¼š
- `status?`: 'pending' | 'approved' | 'rejected' (å¯é¸)

**å›æ‡‰æ ¼å¼**ï¼š
```typescript
{
  success: true;
  data: {
    customers: Customer[];
  };
}
```

#### POST `/api/admin/approve`

**åŠŸèƒ½**ï¼šå¯©æ ¸é€šé

**èªè­‰**ï¼šéœ€è¦ç®¡ç†å“¡æ¬Šé™

**è«‹æ±‚æ ¼å¼**ï¼š
```typescript
{
  customerId: string;
}
```

**å›æ‡‰æ ¼å¼**ï¼š
```typescript
{
  success: true;
  message: string;
}
```

#### POST `/api/admin/reject`

**åŠŸèƒ½**ï¼šå¯©æ ¸æ‹’çµ•

**èªè­‰**ï¼šéœ€è¦ç®¡ç†å“¡æ¬Šé™

**è«‹æ±‚æ ¼å¼**ï¼š
```typescript
{
  customerId: string;
}
```

**å›æ‡‰æ ¼å¼**ï¼š
```typescript
{
  success: true;
  message: string;
}
```

---

## è³‡æ–™åº«è¦æ ¼

### è³‡æ–™è¡¨çµæ§‹

è©³ç´°è³‡æ–™è¡¨çµæ§‹è«‹åƒè€ƒ [ARCHITECTURE.md](./ARCHITECTURE.md#è³‡æ–™åº«è¨­è¨ˆ)

### è³‡æ–™å®Œæ•´æ€§ç´„æŸ

1. **å¤–éµç´„æŸ**ï¼š
   - `sessions.customer_id` â†’ `customers.id` (ON DELETE CASCADE)
   - `chat_conversations.customer_id` â†’ `customers.id` (ON DELETE CASCADE)
   - `chat_messages.conversation_id` â†’ `chat_conversations.id` (ON DELETE CASCADE)

2. **å”¯ä¸€ç´„æŸ**ï¼š
   - `customers.email` (å”¯ä¸€)

3. **æª¢æŸ¥ç´„æŸ**ï¼š
   - `customers.auth_provider` IN ('password', 'otp', 'google')
   - `customers.approval_status` IN ('pending', 'approved', 'rejected')
   - `customers.role` IN ('user', 'admin')
   - `chat_conversations.workload_level` IN ('instant', 'basic', 'standard', 'professional')
   - `chat_messages.role` IN ('user', 'assistant')

### ç´¢å¼•ç­–ç•¥

æ‰€æœ‰æŸ¥è©¢æ¬„ä½éƒ½æœ‰å»ºç«‹ç´¢å¼•ä»¥å„ªåŒ–æ•ˆèƒ½ï¼š

- `customers.email` - ä¸»è¦æŸ¥è©¢æ¬„ä½
- `customers.oauth_id` - OAuth æŸ¥è©¢
- `customers.approval_status` - å¯©æ ¸ç‹€æ…‹æŸ¥è©¢
- `customers.role` - è§’è‰²æŸ¥è©¢
- `sessions.customer_id` - å®¢æˆ¶ Session æŸ¥è©¢
- `sessions.token` - Token é©—è­‰
- `otp_tokens.email` - OTP æŸ¥è©¢
- `otp_tokens.token` - OTP é©—è­‰
- `chat_conversations.customer_id` - å®¢æˆ¶å°è©±æŸ¥è©¢
- `chat_messages.conversation_id` - å°è©±è¨Šæ¯æŸ¥è©¢

---

## UI/UX è¦æ ¼

### é é¢çµæ§‹

#### èªè­‰é é¢

1. **ç™»å…¥é é¢** (`/login`)
   - Email è¼¸å…¥æ¡†
   - å¯†ç¢¼è¼¸å…¥æ¡†ï¼ˆå¯†ç¢¼ç™»å…¥ï¼‰
   - OTP è¼¸å…¥æ¡†ï¼ˆOTP ç™»å…¥ï¼‰
   - Google ç™»å…¥æŒ‰éˆ•
   - åˆ‡æ›ç™»å…¥æ–¹å¼
   - è¨»å†Šé€£çµ

2. **è¨»å†Šé é¢** (`/register`)
   - Email è¼¸å…¥æ¡†
   - å§“åè¼¸å…¥æ¡†
   - å¯†ç¢¼è¼¸å…¥æ¡†ï¼ˆå¯†ç¢¼è¨»å†Šï¼‰
   - OTP è¼¸å…¥æ¡†ï¼ˆOTP è¨»å†Šï¼‰
   - Google è¨»å†ŠæŒ‰éˆ•
   - åˆ‡æ›è¨»å†Šæ–¹å¼
   - ç™»å…¥é€£çµ

#### ä¸»é é¢

1. **å°è©±é é¢** (`/chat`)
   - å°è©±è¦–çª—ï¼ˆè¨Šæ¯åˆ—è¡¨ï¼‰
   - è¼¸å…¥å€åŸŸï¼ˆæ–‡å­—è¼¸å…¥æ¡†ï¼‰
   - æª”æ¡ˆä¸Šå‚³æŒ‰éˆ•
   - åŠŸèƒ½é¸æ“‡å™¨ï¼ˆæª¢é©—/æ”¾å°„/ç—…æ­·/è—¥ç‰©ï¼‰
   - å·¥ä½œé‡ç´šåˆ¥é¸æ“‡å™¨ï¼ˆå³æ™‚/åˆç´š/æ¨™æº–/å°ˆæ¥­ï¼‰
   - ç™¼é€æŒ‰éˆ•

2. **å°è©±è¨˜éŒ„é é¢** (`/conversations`)
   - å°è©±åˆ—è¡¨ï¼ˆå¡ç‰‡å¼ï¼‰
   - æ¯å€‹å°è©±é¡¯ç¤ºï¼šæ¨™é¡Œã€å»ºç«‹æ™‚é–“ã€æœ€å¾Œæ›´æ–°æ™‚é–“
   - é»æ“Šå°è©±ç¹¼çºŒå°è©±

3. **ç®¡ç†é é¢** (`/admin`)
   - å®¢æˆ¶åˆ—è¡¨
   - å¯©æ ¸æŒ‰éˆ•ï¼ˆé€šé/æ‹’çµ•ï¼‰
   - å®¢æˆ¶è©³ç´°è³‡è¨Š

### å…ƒä»¶è¦æ ¼

#### èªè­‰å…ƒä»¶

1. **OTPInput**
   - 6 å€‹ç¨ç«‹çš„è¼¸å…¥æ¡†
   - è‡ªå‹•è·³è½‰åˆ°ä¸‹ä¸€å€‹è¼¸å…¥æ¡†
   - æ”¯æ´è²¼ä¸Š 6 ä½æ•¸é©—è­‰ç¢¼
   - è‡ªå‹•èšç„¦ç¬¬ä¸€å€‹è¼¸å…¥æ¡†

2. **CountdownTimer**
   - å€’æ•¸è¨ˆæ™‚é¡¯ç¤ºï¼ˆç§’ï¼‰
   - å€’æ•¸çµæŸå¾Œé¡¯ç¤ºã€Œé‡æ–°ç™¼é€ã€æŒ‰éˆ•

3. **GoogleLoginButton**
   - Google å“ç‰Œæ¨£å¼
   - é»æ“Šå¾Œè§¸ç™¼ Google OAuth æµç¨‹

#### å°è©±å…ƒä»¶

1. **ChatWindow**
   - å°è©±è¦–çª—å®¹å™¨
   - è‡ªå‹•æ»¾å‹•åˆ°åº•éƒ¨
   - éŸ¿æ‡‰å¼ä½ˆå±€

2. **MessageList**
   - è¨Šæ¯åˆ—è¡¨
   - ä½¿ç”¨è€…è¨Šæ¯ï¼ˆå³å´ï¼Œè—è‰²ï¼‰
   - AI å›æ‡‰ï¼ˆå·¦å´ï¼Œç°è‰²ï¼‰
   - è¼‰å…¥ç‹€æ…‹é¡¯ç¤º

3. **MessageBubble**
   - è¨Šæ¯æ°£æ³¡æ¨£å¼
   - æ”¯æ´æ–‡å­—å…§å®¹
   - æ”¯æ´æª”æ¡ˆé¡¯ç¤ºï¼ˆåœ–ç‰‡é è¦½ã€æª”æ¡ˆä¸‹è¼‰é€£çµï¼‰

4. **ChatInput**
   - æ–‡å­—è¼¸å…¥æ¡†
   - æª”æ¡ˆä¸Šå‚³æŒ‰éˆ•
   - åŠŸèƒ½é¸æ“‡å™¨
   - å·¥ä½œé‡ç´šåˆ¥é¸æ“‡å™¨
   - ç™¼é€æŒ‰éˆ•

5. **FunctionSelector**
   - 4 å€‹åŠŸèƒ½é¸é …ï¼ˆæª¢é©—/æ”¾å°„/ç—…æ­·/è—¥ç‰©ï¼‰
   - å–®é¸æŒ‰éˆ•æ¨£å¼
   - å¯é¸ï¼ˆå¯é¸å¯ä¸é¸ï¼‰

6. **WorkloadSelector**
   - 4 å€‹ç´šåˆ¥é¸é …ï¼ˆå³æ™‚/åˆç´š/æ¨™æº–/å°ˆæ¥­ï¼‰
   - å–®é¸æŒ‰éˆ•æ¨£å¼
   - å¿…é¸

7. **FileUploader**
   - æ‹–æ”¾ä¸Šå‚³å€åŸŸ
   - é»æ“Šä¸Šå‚³æŒ‰éˆ•
   - æª”æ¡ˆé è¦½
   - æª”æ¡ˆå¤§å°é™åˆ¶æç¤ºï¼ˆ10MBï¼‰
   - æ”¯æ´æ ¼å¼æç¤ºï¼ˆJPEG/PDF/DOCX/TXTï¼‰

#### å¼•å°å…ƒä»¶

1. **OnboardingModal**
   - 4 å€‹æ­¥é©Ÿå¡ç‰‡
   - é€²åº¦æŒ‡ç¤ºå™¨
   - ä¸‹ä¸€æ­¥/ä¸Šä¸€æ­¥æŒ‰éˆ•
   - å®ŒæˆæŒ‰éˆ•
   - é¦–æ¬¡ç™»å…¥è‡ªå‹•é¡¯ç¤º

### è¨­è¨ˆè¦ç¯„

1. **è‰²å½©ç³»çµ±**ï¼š
   - ä¸»è‰²ï¼šè—è‰²ï¼ˆ#3B82F6ï¼‰
   - æˆåŠŸï¼šç¶ è‰²ï¼ˆ#10B981ï¼‰
   - éŒ¯èª¤ï¼šç´…è‰²ï¼ˆ#EF4444ï¼‰
   - è­¦å‘Šï¼šé»ƒè‰²ï¼ˆ#F59E0Bï¼‰

2. **å­—é«”**ï¼š
   - é è¨­ï¼šç³»çµ±å­—é«”å †ç–Š
   - æ¨™é¡Œï¼šç²—é«”
   - å…§æ–‡ï¼šæ­£å¸¸

3. **é–“è·**ï¼š
   - ä½¿ç”¨ Tailwind CSS æ¨™æº–é–“è·ç³»çµ±

4. **éŸ¿æ‡‰å¼è¨­è¨ˆ**ï¼š
   - è¡Œå‹•è£ç½®ï¼šå–®æ¬„ä½ˆå±€
   - æ¡Œé¢ï¼šé›™æ¬„ä½ˆå±€ï¼ˆå°è©±åˆ—è¡¨ + å°è©±è¦–çª—ï¼‰

---

## å®‰å…¨æ€§è¦æ ¼

### èªè­‰å®‰å…¨

1. **å¯†ç¢¼å®‰å…¨**ï¼š
   - æœ€å°é•·åº¦ï¼š8 å€‹å­—å…ƒ
   - åŠ å¯†æ–¹å¼ï¼šbcryptï¼ˆsalt rounds: 10ï¼‰
   - ä¸å„²å­˜æ˜æ–‡å¯†ç¢¼

2. **Session å®‰å…¨**ï¼š
   - JWT Token ä½¿ç”¨ HS256 æ¼”ç®—æ³•
   - Token æœ‰æ•ˆæœŸï¼š7 å¤©
   - Token å„²å­˜åœ¨ HttpOnly Cookie
   - SameSite: 'lax'

3. **OTP å®‰å…¨**ï¼š
   - 6 ä½æ•¸éš¨æ©Ÿæ•¸å­—
   - æœ‰æ•ˆæœŸï¼š10 åˆ†é˜
   - ä½¿ç”¨å¾Œç«‹å³å¤±æ•ˆ
   - Rate Limitingï¼šæ¯ Email æ¯ 15 åˆ†é˜æœ€å¤š 3 æ¬¡ç™¼é€

### API å®‰å…¨

1. **Rate Limiting**ï¼š
   - ç™»å…¥/è¨»å†Šï¼šæ¯ IP æ¯ 15 åˆ†é˜ 5 æ¬¡
   - OTP ç™¼é€ï¼šæ¯ Email æ¯ 15 åˆ†é˜ 3 æ¬¡
   - OTP é©—è­‰ï¼šæ¯ Email æ¯ 15 åˆ†é˜ 10 æ¬¡

2. **è¼¸å…¥é©—è­‰**ï¼š
   - æ‰€æœ‰ API è¼¸å…¥éƒ½ç¶“é Zod é©—è­‰
   - é˜²æ­¢ SQL æ³¨å…¥ï¼ˆä½¿ç”¨åƒæ•¸åŒ–æŸ¥è©¢ï¼‰
   - é˜²æ­¢ XSSï¼ˆReact è‡ªå‹•è½‰ç¾©ï¼‰

3. **æ¬Šé™æ§åˆ¶**ï¼š
   - æ‰€æœ‰ API éƒ½éœ€è¦ Session é©—è­‰ï¼ˆé™¤äº†èªè­‰ APIï¼‰
   - ç®¡ç† API éœ€è¦ç®¡ç†å“¡æ¬Šé™
   - ä½¿ç”¨è€…åªèƒ½å­˜å–è‡ªå·±çš„è³‡æ–™

### è³‡æ–™å®‰å…¨

1. **æ•æ„Ÿè³‡æ–™åŠ å¯†**ï¼š
   - å¯†ç¢¼ï¼šbcrypt é›œæ¹Š
   - JWT Secretï¼šç’°å¢ƒè®Šæ•¸ï¼ˆä¸æäº¤åˆ° Gitï¼‰

2. **è³‡æ–™åº«å®‰å…¨**ï¼š
   - ä½¿ç”¨ Supabase è¨—ç®¡æœå‹™
   - é€£ç·šä½¿ç”¨ SSL
   - ä½¿ç”¨æœ€å°æ¬Šé™åŸå‰‡

3. **æª”æ¡ˆä¸Šå‚³å®‰å…¨**ï¼š
   - æª”æ¡ˆå¤§å°é™åˆ¶ï¼š10MB
   - æª”æ¡ˆé¡å‹é™åˆ¶ï¼šJPEGã€PDFã€DOCXã€TXT
   - æª”æ¡ˆå„²å­˜åœ¨ Cloudflare R2ï¼ˆç§æœ‰å„²å­˜ï¼‰

---

## æ•ˆèƒ½è¦æ ¼

### å›æ‡‰æ™‚é–“ç›®æ¨™

| æ“ä½œ | ç›®æ¨™å›æ‡‰æ™‚é–“ |
|------|--------------|
| é é¢è¼‰å…¥ | < 2 ç§’ |
| API å›æ‡‰ | < 1 ç§’ |
| AI å›æ‡‰ç”Ÿæˆ | < 10 ç§’ |
| æª”æ¡ˆä¸Šå‚³ | < 5 ç§’ï¼ˆ10MBï¼‰ |

### ä¸¦ç™¼è™•ç†

- **API ä¸¦ç™¼**ï¼šVercel Serverless Functions è‡ªå‹•æ“´å±•
- **è³‡æ–™åº«é€£ç·š**ï¼šSupabase è‡ªå‹•ç®¡ç†é€£ç·šæ± 
- **æª”æ¡ˆä¸Šå‚³**ï¼šCloudflare R2 æ”¯æ´é«˜ä¸¦ç™¼

### å¿«å–ç­–ç•¥

- **Session é©—è­‰**ï¼šå¯å¿«å–é©—è­‰çµæœï¼ˆæœªä¾†å¯æ“´å±•ï¼‰
- **å°è©±åˆ—è¡¨**ï¼šå¯å¯¦ä½œå®¢æˆ¶ç«¯å¿«å–ï¼ˆæœªä¾†å¯æ“´å±•ï¼‰

### å„ªåŒ–æªæ–½

1. **è³‡æ–™åº«å„ªåŒ–**ï¼š
   - æ‰€æœ‰æŸ¥è©¢æ¬„ä½éƒ½æœ‰ç´¢å¼•
   - ä½¿ç”¨åƒæ•¸åŒ–æŸ¥è©¢
   - é¿å… N+1 æŸ¥è©¢å•é¡Œ

2. **å‰ç«¯å„ªåŒ–**ï¼š
   - Next.js App Router è‡ªå‹•ç¨‹å¼ç¢¼åˆ†å‰²
   - Tailwind CSS åƒ…è¼‰å…¥ä½¿ç”¨çš„æ¨£å¼
   - åœ–ç‰‡å„ªåŒ–ï¼ˆæœªä¾†å¯æ“´å±•ï¼‰

3. **API å„ªåŒ–**ï¼š
   - æ¸›å°‘ä¸å¿…è¦çš„è³‡æ–™åº«æŸ¥è©¢
   - ä½¿ç”¨é©ç•¶çš„ HTTP ç‹€æ…‹ç¢¼
   - éŒ¯èª¤è™•ç†å„ªåŒ–
   - **æ¨¡å‹è³‡æ–™å³æ™‚æ€§**ï¼šAPI ä½¿ç”¨ `force-dynamic`ï¼Œå‰ç«¯ Fetch ä½¿ç”¨ `cache: 'no-store'`

---

## åƒè€ƒæ–‡ä»¶

- [ARCHITECTURE.md](./ARCHITECTURE.md) - ç³»çµ±æ¶æ§‹
- [README.md](./README.md) - å°ˆæ¡ˆèªªæ˜
- [DEPLOYMENT_GUIDE.md](./DEPLOYMENT_GUIDE.md) - éƒ¨ç½²æŒ‡å—
- [ENV_VARIABLES.md](./ENV_VARIABLES.md) - ç’°å¢ƒè®Šæ•¸èªªæ˜

---

**æ–‡ä»¶ç¶­è­·è€…**ï¼šé–‹ç™¼åœ˜éšŠ  
**æœ€å¾Œå¯©æŸ¥æ—¥æœŸ**ï¼š2026-01-29
